@model Projecto.Models.ViewModels.TicketUpdateFormModel

<h2>@Model.Ticket.Title</h2>

<form asp-controller="Tickets" asp-action="Edit" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Ticket.Id" />
    <p>Description: @Model.Ticket.Description</p>
    <div class="form-group">
        <label asp-for="Ticket.Status" class="form-label"></label>
        <select id="statusDropdown" asp-for="Ticket.Status" class="form-select" asp-items="Model.StatusOptions" data-original-value="@Model.Ticket.Status.ToString()"></select>
        <span asp-validation-for="Ticket.Status" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Ticket.Priority" class="form-label"></label>
        <select id="priorityDropdown" asp-for="Ticket.Priority" class="form-select" asp-items="Model.PriorityOptions" data-original-value="@Model.Ticket.Priority.ToString()"></select>
        <span asp-validation-for="Ticket.Priority" class="text-danger"></span>
    </div>
    <p>Created At: @Model.Ticket.CreatedAt</p>
    <p>Due Date: @Model.Ticket.DueDate</p>
    <button id="saveBtn" class="btn btn-primary" type="submit" disabled>Save</button>
    <a href="javascript:history.back()" class="btn btn-secondary">Go Back</a>
</form>

<script>
  (function(){
    const saveBtn = document.getElementById('saveBtn');
    const statusDropdown = document.getElementById('statusDropdown');
    const priorityDropdown = document.getElementById('priorityDropdown');

    // Store original values on load
    const originalStatus = statusDropdown.dataset.originalValue;
    const originalPriority = priorityDropdown.dataset.originalValue;

    // Function to check if changes were made
    function checkChanges() {
      if (statusDropdown.value !== originalStatus || priorityDropdown.value !== originalPriority) {
        saveBtn.disabled = false;
      } else {
        saveBtn.disabled = true;
      }
    }

    // Listen for changes on both dropdowns
    statusDropdown.addEventListener('change', checkChanges);
    priorityDropdown.addEventListener('change', checkChanges);
  })();
</script>